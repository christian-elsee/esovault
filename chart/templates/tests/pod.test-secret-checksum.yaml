apiVersion: v1
kind: Pod
metadata:
  name: test-secret-checksum
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded

spec:
  containers:
    - name: main
      image: alpine:3.20

      command:
        - tests-entrypoint.sh
        - prove
        - /opt/tests/t/test-secret-checksum.t
      args:
        - CHECKSUM

      envFrom:
        - secretRef:
            name: checksum

      volumeMounts:
        - name: entrypoint
          mountPath: /usr/local/bin
        - name: tap
          mountPath: /opt/tests/src
        - name: tests
          mountPath: /opt/tests/t

  volumes:
    - name: entrypoint
      configMap:
        name: entrypoint
    - name: tap
      configMap:
        name: tap
    - name: tests
      configMap:
        name: tests    


